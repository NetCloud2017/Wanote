### 了解 Javascript

1、 程序是怎么执行的？

同步代码中， js 是从上到下 执行的。 先进词法解析，接着语法解析， 然后进行构建 抽象语法树（AST）， 然后进行转换（ transform 机器可以执行的代码)， 接着 生成代码。

2、 对于 JS 来说，一个变量，是如何被赋值和使用的，有什么区别？

主要分为两个阶段：
预编译阶段：
变量声明， 用 var 声明的变量和函数声明进行变量提升， 这时它的值是 undefined。

代码执行阶段:

例如：

```JS
var a = "hello world";
```

编译器问， 当前作用域是不是已经有了一个变量 a , 有则继续下去， 没则产生一个新的变量 a; 然后产生一条 `a = 2` 这条能够吧引擎执行的代码；

引擎在执行时，会问作用域，是不是已经有一个 a, 在当前的作用域中？ 如果是,赋值为 2; 如果不是,去**上一层的作用域**中去找。

### 作用域

> 作用域，就是根据名称，去查找变量的规则。作用域分静态作用域和动态作用域。

#### 词法作用域(静态作用域)

首先先来解释一下作用域就是作用的范围，比如定义一个普通函数，该函数就会有自己的作用域，并且在函数里面定义的变量，函数外面是使用不了函数里面定义的变量的，作用域决定了代码区块中的变量和其他资源的可见性。

而作用域也分为静态作用域和动态作用域，词法作用域就是静态作用域，静态作用域在函数定义的时候就决定了，而动态作用域在函数调用时才决定。静态作用域在编译时期（词法解析阶段）就确定好了，所以也叫词法作用域。

对于编译型语言,编译步骤：词法分析->语法分析->语义检查->代码优化->字节码生成

对于解释型语言，编译步骤：语法检查->预编译期（预处理、预解析、预编译，预声明变量，在预定义函数）,然后就可以执行。

javascript 采用的是词法作用域。下面我们来看看例子。

```JS
function fun() {
console.log(a)
}

function bar() {
var a=3
fun()
}

var a=1

bar() // 1
```

在解释这个例子之前，还得讲解另一个知识点。

LHS 和 RHS

LHS(left-hand side)找到变量所在的容器本身，并且将对该变量进行赋值。

RHS(right-hand side)查找某个变量的值

LSH 和 RSH 查找过程通过作用域链进行寻找。作用域链在函数定义的时候创建好。

现在说回这个例子，在 fun 函数要执行 console.log(a)，就是要找到变量 a 的值，但是 fun 函数没有变量 a，所以要通过 RSH 查询（当前作用域=>上一级作用域=> ... => 全局作用域）找到变量 a，在全局作用域里找到变量 a，于是就输出 1。

下面我们来看看动态作用域的例子（bash 采用的是动态作用域)

```JS
#!/bin/bash
num=1
function fun1(){
echo $num
}

function fun2(){
local num=2
fun1 // 2
}
fun2

```

动态作用域会从检查函数调用链，查找目标变量出来，所以就可以对上面的例子继续解释，在 fun1 函数找不到 num 变量，就会从调用栈中找到上一级调用 fun1 的函数 fun2，并且在函数 fun2 找到变量 num，所以就会输出 2。

#### 函数作用域（动态作用域 或 上下文）

在运行时的作用域。 即 this 的指向。

### 闭包

什么情况下，我的 上下文 和 作用域 不一致呢？闭包的时候。

#### 面试时被问到什么是闭包，如何解释？

#### 闭包的使用场景？

防抖， 节流。 递归

### this

#### this 指向什么？

this 的指向， 是根据我的执行上下文， 动态决定的。

- 在简单调用时，this 默认指向的是 window / global / undefined (浏览器/node/严格模式)
- 在对象调用时，绑定在对象上
- 在使用 call / apply / bind 时。绑定在制定的参数上
- 使用 new 关键字是，绑定到新创建的对象上
  ( 以上三条优先级： new > apply/call/bind > 对象调用 )
- 使用箭头函数，根据外层的规则确定。

#### 思考题

在考虑 new 的优先级， 比 bind 高的时候，这个 bind 的实现应该怎么改？
