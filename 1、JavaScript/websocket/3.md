# websocket 通讯流程

## 握手流程

基于 HTTP 调用完成握手操作，如下图所示，客户端首先发起一个 HTTP 请求到服务端，该请求的特殊之处在于在 Header 里面包括一个 upgrade 字段，告诉服务端想升级成 WebSocket 协议。

服务端收到后就会响应一个握手的确认，发送 switching 表示允许客户端向 WebSocket 协议转换。

## 传输原理

协议升级后，继续复用 HTTP 的 底层 Socket 完成后续通讯

Message 底层会被切成多个 Frame 传输

编程时只需要操作 Message，无需关心 Frame

框架底层完成 TCP 网络 I/O，WebSocket 协议解析，开发者无需关心

## 事件

打开事件： 此事件发生在端点建立新连接时并且在任何其他事件发生之前。

消息事件： 此事件接收 WebSocket 对话中另一端发送的消息。它可以发生在 WebSocket 端点接收了打开事件之后并且在接收关闭事件关闭连接之前的任意时刻。

错误事件： 此事件在 WebSocket 连接或者端点发生错误时产生。

关闭事件： 此事件表示 WebSocket 端点的连接目前正在部分地关闭，它可以由参与连接的任意一个端点发出。
