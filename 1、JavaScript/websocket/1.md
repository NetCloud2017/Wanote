# [websocket](https://geek-docs.com/websocket/websocket-tutorials/websockets-overview.html)

[掘金相关文章](https://juejin.cn/search?query=websocket&type=0&sort=2)

**websocket 特点:**

节省通信开销：以前的 WebServer 使用推送或用轮询技术完成实时通信，需要客户端不停向服务器发送 HTTP 请求，但是 HTTP 的 Header 是非常长的，里面包含的数据可能只是一个很小的值，占用了很多带宽和服务器资源，用 WebSocket 可以避免这一问题

服务器主动传送数据给客户端：WebSocket 可以使服务器和客户端相互推送信息

实时通信：一旦握手建立后，就可以实时通信。

websocket 的最大优点是它通过单个 TCP 连接提供双向通信(全双工)。

**websocket URL**

<img src="./img/websocket-url.jpg" />

**websocket 与 TCP、HTTP 的关系**

WebSocket 与 http 协议一样都是基于 TCP 的，所以他们都是可靠的协议，Web 开发者调用的 WebSocket 的 send 函数在 browser 的实现中最终都是通过 TCP 的系统接口进行传输的。WebSocket 和 Http 协议一样都属于应用层的协议，那么他们之间有没有什么关系呢？答案是肯定 的，WebSocket 在建立握手连接时，数据是通过 http 协议传输的，这里面用到的只是 http 协议一些简单的字段。但是在建立连接之后，真正的数据传输阶段是不需要 http 协议参与的。

<img  src="./img/websocket-http-tcpip.jpg" />

**为啥选择 websocket ?**

websocket 之前的实时通讯方案：

- 轮询（Polling）

  在 websocket 没有出现之前是通过浏览器不对轮询向服务端发出请求来模仿实时通讯的， 但是每次请求都带有请求头和这很消耗流量和 CPU 利用率。

  短轮询效率低，非常浪费资源（网络带宽和计算资源）。有一定延迟、服务器压力较大，并且大部分是无效请求。

- 长轮询（Long Polling）

  长轮询是对轮询的改进版，客户端发送 HTTP 给服务器之后，有没有新消息，如果没有新消息，就一直等待。直到有消息或者超时了，才会返回给客户端。消息返回后，客户端再次建立连接，如此反复。这种做法在某种程度上减小了网络带宽和 CPU 利用率等问题。

  长轮询虽然省去了大量无效请求，减少了服务器压力和一定的网络带宽的占用，但是还是需要保持大量的连接。

* 数据流（Streaming）

  数据流是实时数据传输的最佳选择。服务器保持连接打开并与客户端一起激活，直到并且除非提取所需的数据。在这种情况下，连接是无限期打开的。流传输包括 HTTP 标头，这会增加文件大小，增加延迟。这是一个主要缺点。

  基于流的方式，在服务器往客户端推送，这个方向的流实时性比较好。但是依旧是单向的，客户端请求服务器依然还需要一次 HTTP 请求

为了一种完美的实时通讯方案 websocket 就诞生了， 它能双向通信，又可以节约请求的 header 网络开销，并且有更强的扩展性，最好还可以支持二进制帧，压缩等特性

> 其他概念：

**轮询**: 是在特定的的时间间隔（如每 1 秒），由浏览器对服务器发出 HTTP 请求，然后由服务器返回最新的数据给客户端的浏览器。
