# websocket 事件

WebSocket 协议也是事件驱动的，客户应用程序不需要轮序服务来得到更新的数据，消息和事件将在服务器发送它们的时候异步到达。

WebSocket 编程遵循异步编程模式，也就是说，只要 WebSocket 连接打开，应用程序就简单监听事件。客户端不需要主动轮询服务器得到更多的信息。要开始监听事件，只要为 WebSocket 对象添加回调函数即可。也可以使用 addEventListener() DOM 方法为 WebSocket 对象添加事件监听器。

| 事件    | 事件处理程序     | 描述                       |
| :------ | :--------------- | :------------------------- |
| open    | Socket.onopen    | 连接建立时触发             |
| message | Socket.onmessage | 客户端接收服务端数据时触发 |
| error   | Socket.onerror   | 通信发生错误时触发         |
| close   | Socket.onclose   | 连接关闭时触发             |

**onopen**

```javascript
ws.onopen = function (e) {
	console.log("Geek-docs Connect open...");
};
```

到 open 事件触发时，协议握手已经完成，WebSocket 已经准备好发送和接收数据。如果应用程序接收到一个 open 事件，那么可以确定 WebSocket 服务器成功地处理了连接请求，并且同意与应用程序通信。

**message**

WebSocket 消息包含来自服务器的数据。你也可能听说过组成 WebSocket 消息的 WebSocket 帧（Frame）。

为了理解消息使用 API 的方式，WebSocket API 只输出完整的消息，而不是 WebSocket 帧。message 事件在接收到消息时触发，对应于该事件的回调函数 onmessage。

示例：接收文本消息并显示消息内容

```javascript
ws.onmessage = function (e) {
	if (typeof e.data === "string") {
		console.log("String message from geek-docs.com received", e, e.data);
	} else {
		console.log("Other message from geek-docs.com received", e, e.data);
	}
};
```

除了文本，WebSocket 消息还可以处理二进制数据，这种数据作为 Blob 消息或 ArrayBuffer 消息。

```javascript
ws.binaryType = "blob";

ws.onmessage = function (e) {
	if (e.data instanceof Blob) {
		console.log("Blob message received", e.data);
		var blob = new Blob(e.data);
	}
};
```

```javascript
ws.binaryType = "arraybuffer";
ws.onmessage = function (e) {
	if (e.data instanceof ArrayBuffer) {
		console.log("ArrayBuffer Message Received", e.data);
		var a = new Uint8Array(e.data);
	}
};
```

**error**
error 事件在响应意外故障的时候触发，与该事件对应的回调函数为 onerror。

错误还会导致 WebSocket 连接关闭。如果你接收一个 error 事件，可以预期很快就会发生 close 事件。

close 事件中的代码和原因有时候能告诉你错误的根源，error 事件处理程序是调用服务器重连逻辑以及处理来自 WebSocket 对象异常的最佳场所。

下面的示例展示监听 error 事件

```javascript
ws.onerror = function (e) {
	console.log("WebSocket Error:", e);
	handleErrors(e);
};
```

**close**

close 事件在 WebSocket 连接关闭时触发，对应于 close 事件的回调函数是 onclose。

一旦连接关闭，客户端和服务器不再接收或者发送消息。

当调用 close() 方法终止与服务器的连接时，也会触发 onclose 事件处理程序。

下面的示例代码展示 close 事件处理程序

```javascript
ws.onclose = function (e) {
	console.log("Connectoin from geek-docs.com closed.", e);
};
```

## 实例方法

```javascript
Socket.send(); //使用连接发送数据
Socket.close(); //关闭连接
```
